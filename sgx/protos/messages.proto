syntax = "proto3";

package oram;

import "google/protobuf/empty.proto";

// This defines all the functionalies that a remote server should provide.
// Currently we only support read / write. This ORAM data are generated by the server at random.
// If you need to upload data to the server, you should define other interfaces.
service sgx_oram {
  // Initialize the enclave and starts to negotiate a shared session key.
  rpc init_enclave(InitRequest) returns (InitReply) {}

  rpc generate_session_key(InitRequest) returns (InitReply) {}

  // ===================================================== //
  // Functions for remote attestation and key derivation.
 // rpc send_message1(MessageMSG1) returns (MessageMSG2) {}

  // rpc send_message3(MessageMSG3) returns (AttestationMessage) {}
  // ===================================================== //

  rpc read_block(ReadRequest) returns (ReadReply) {}

  rpc write_block(WriteRequest) returns (WriteReply) {}

  rpc close_connection(CloseRequest) returns (google.protobuf.Empty) {}
}

message InitRequest {
  // The round variable indicates the current phase of the key negotiation.
  int32 round = 1;
  bytes content = 2;
}

message InitReply {
  bool success = 1;

  // Shared session key for symmetric encryption.
  // This is done by SGX's remote attestation procedure.
  // This field is valid iff. the negotiation finishes.
  bytes content = 2;
}

message ReadRequest {
  uint32 address = 1;
}

message ReadReply {
  string block = 1;
  bool success = 2;
}

message WriteRequest {
  uint32 address = 1;
  string data = 2;
}

message WriteReply {
  bool success = 1;
}

message CloseRequest {
}

